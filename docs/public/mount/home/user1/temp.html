<title>ReactJS</title>
<script type="module" defer>
  // const React = window.platform.getService('React')
  const {React, ReactDOM, App} = window.platform.require('/home/user1/temp.js')
  const {createRoot} = ReactDOM

  const el = document.createElement('div')
  el.setAttribute('id', 'react-root')
  const root = createRoot(el)
  document.body.appendChild(el)
  root.render(React.createElement(App, {}, []))

    let exec = () => { }

    // const openProfileCommand = `service('001-core.layout', 'open-window') (command('ui.iframe'), '/home/user1/index.html');`
    // const openThreeJSCommand = `service('001-core.layout', 'open-window') (command('ui.iframe'), '/home/user1/projects/WebGL-Earth.html');`
    // const command = `service('001-core.layout', 'open-window') (command('ui.iframe'), '/home/user1/temp.html');`
    // document.getElementById('openProfileButton').onclick = () => window.platform.host.execCommand(openProfileCommand);
    // document.getElementById('openThreeJSButton').onclick = () => window.platform.host.execCommand(openThreeJSCommand);

    const code = `
    
    onmessage = function(event) {
      const { id, type, payload } = event.data;
      if(type === 'INIT') {
        console.log("INIT")
        return
      }


      const {url} = payload
      fetch(url)
          .then(res => res.json())
          .then(data => {
              const result = { status: 'success', data: data };
              postMessage({ id, result });
          })
          

      
      // const result = { status: 'success', data: payload };
      // postMessage({ id, result }); // Return response to caller with the same id
    }
  `;

    const blob = new Blob([code], { type: "application/javascript" });
    const workerUrl = URL.createObjectURL(blob);
    // const worker = new Worker(workerUrl);

    function postMessageToWorker(worker, message) {
        return new Promise((resolve, reject) => {
            const id = Date.now() + Math.random(); // Unique ID for each request

            const handler = function (event) {
                if (event.data.id === id) {
                    resolve(event.data.result); // Resolve the promise with worker's response
                    worker.removeEventListener('message', handler); // Clean up event listener
                }
            };

            worker.addEventListener('message', handler);

            worker.onerror = function (error) {
                reject(error); // Reject the promise if there's an error
                worker.removeEventListener('message', handler); // Clean up on error
            };

            worker.postMessage({ ...message, id }); // Send the message to the worker with the unique id
        });
    }

    // const url = 'https://jsonplaceholder.org/posts/1';
    // postMessageToWorker(worker, { type: 'GET', payload: { url: url } })
    //   .then(response => {
    //     console.log('Worker response 1:', response);
    //   })
    //   .catch(error => {
    //     console.error('Worker error 1:', error);
    //   });

    // postMessageToWorker(worker, { type: 'INIT', payload: { } })


</script>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: white;
  }
  #react-root {
    display: flex;
    align-items: center;
    flex-direction: column;
    font-family: system-ui;
  }
</style>

<!-- <button id="openProfileButton">
    Portfolio
</button> -->
<!-- <button id="openThreeJSButton">
    Open ThreeJS
</button> -->