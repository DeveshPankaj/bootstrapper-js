<style>
  body {
    margin: 0;
  }

  #dragger {
    width: 10rem;
    height: 10rem;
    background: #c2c2c2;
    cursor: pointer;
    display: none;
  }
</style>
<script type="module" defer>
  onload = () => {
    const React = platform.getService('React');
    const ReactDOM = platform.getService('ReactDOM');
    const props = platform.getService('props');

    // console.log(props, React, ReactDOM);

    props.toggleHeader(false);
    
    const dom = document.getElementById('react-root');
    const root = ReactDOM.createRoot(dom);
    const appModuleSource = document.querySelector('script[type="text/React-Jsx"]').innerText;

    const {App} = platform.host.execString(appModuleSource);
    root.render(React.createElement(App, props, []));
    


    // document.getElementById('render-btn').addEventListener('click', () => {
    //   props.close();
    // });

    // const dragger = document.getElementById('dragger');
    const dragger = dom
    
    let isDragging = false;
    let startX, startY, startRect;

    const onDragStart = (event) => {
      isDragging = true;
      startRect = props.getBoundingClientRect();
      startX = event.clientX;
      startY = event.clientY;
      event.preventDefault(); // Prevent default dragging behavior
    };

    const onDrag = (event) => {
      if (!isDragging) return;

      const deltaX = event.clientX - startX;
      const deltaY = event.clientY - startY;

      const newRect = {
        left: startRect.left + deltaX,
        top: startRect.top + deltaY,
        right: startRect.right + deltaX,
        bottom: startRect.bottom + deltaY
      };

      props.setBoundingClientRect(newRect);
    };

    const onDragEnd = () => {
      isDragging = false;
    };

    dragger.addEventListener('mousedown', onDragStart);
    window.addEventListener('mousemove', onDrag);
    window.addEventListener('mouseup', onDragEnd);

    // Function to center the iframe
    const centerIframe = () => {
      const currentRect = props.getBoundingClientRect();
      const iframeWidth = currentRect.right - currentRect.left;
      const iframeHeight = currentRect.bottom - currentRect.top;

      // Parent dimensions based on iframe size and offsets, using props.host dimensions
      const parentWidth = iframeWidth + currentRect.left + (props.host.innerWidth - currentRect.right);
      const parentHeight = iframeHeight + currentRect.top + (props.host.innerHeight - currentRect.bottom);

      // Calculate new centered position
      const newRect = {
        left: (parentWidth - iframeWidth) / 2,
        top: (parentHeight - iframeHeight) / 2,
        right: (parentWidth + iframeWidth) / 2,
        bottom: (parentHeight + iframeHeight) / 2
      };

      props.setBoundingClientRect(newRect);
    };

    centerIframe()
  };
</script>
<script type="text/React-Jsx">
const React = require('React');
exports.App = (props) => {
  const onCloseHandler = () => {
    props.close();
  };

  return (
    <>
      <span
        className="close-button"
        title="Close window"
        onClick={onCloseHandler}
      ></span>
    </>
  );
};
</script>

<style>
.close-button {
  position: absolute;
  top: 10px;  /* Distance from the top of the container */
  right: 10px;  /* Distance from the right of the container */
  cursor: pointer;
  width: 24px;  /* Button size */
  height: 24px;
  display: inline-block;
  border-radius: 50%;
  background-color: transparent;
  transition: background-color 0.3s, transform 0.3s;
  z-index: 1000;  /* Ensure it stays on top */
}

.close-button::before,
.close-button::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  width: 16px;  /* Length of the "X" lines */
  height: 2px;  /* Thickness of the "X" lines */
  background-color: #333;
  transition: background-color 0.3s;
}

.close-button::before {
  transform: translate(-50%, -50%) rotate(45deg);
}

.close-button::after {
  transform: translate(-50%, -50%) rotate(-45deg);
}

.close-button:hover {
  background-color: #ffffff;
  transform: scale(1.1);
}

.close-button:hover::before,
.close-button:hover::after {
  background-color: #000;
}
</style>

<div draggable id="react-root" style="background: #ffffff66;height: 100%;width: 100%;"></div>
<div draggable id="dragger"></div>
<!-- <button id="render-btn">Render</button> -->

